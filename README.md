### Общая архитектура

Проект представляет собой микросервисное приложение с тремя основными сервисами и API Gateway:

- **API Gateway (gateway):** организует единую точку входа, маршрутизируя запросы к другим сервисам. Выполняет проверку авторизации через сервис security, разграничивает доступ к публичным и защищенным эндпоинтам, проксирует запросы к uploader, storage (MinIO) и security сервисам.  
- **Storage (MinIO):** S3-совместимое объектное хранилище, обеспечивающее хранение и выдачу файлов (например, изображений). Данные хранятся в volume `data`.  
- **Uploader:** сервис на Node.js, который принимает загрузку изображений, проверяет корректность типа, генерирует уникальное имя файла и сохраняет его через MinIO клиент. Также экспортирует метрики Prometheus для мониторинга.  
- **Security:** сервис на Python с Flask, реализующий аутентификацию пользователей с помощью JWT и хранением паролей в виде хешей. Обрабатывает выдачу и валидацию токенов, интегрирован с Prometheus для сбора метрик.

***

### Основные функции и особенности

- **API Gateway**:
  - Обеспечивает маршрутизацию и защиту через внутренний эндпоинт `/auth`, который вызывает security-сервис для проверки токенов.
  - Отделяет публичные (`/v1/token`, `/v1/register`) и защищенные маршруты (`/v1/user`, `/v1/upload`).
  - Статический конфиг nginx используется для балансировки и управления запросами.

- **Security-сервис**:
  - Использует JWT для аутентификации и авторизации.
  - Простейшая реализация пользователей в памяти с хешированным паролем.
  - Обеспечивает метрики и позволяет отпроверджение токенов для защиты маршрутов.

- **Uploader-сервис**:
  - Принимает загрузки изображений через POST, определяет тип и сохраняет в объектное хранилище MinIO.
  - Прозрачно мониторится при помощи Prometheus метрик.
  
- **Storage (MinIO)**:
  - Хранит двоичные файлы, к которым обращаются через gateway.
  - Минимальная настройка с постоянным хранением на volume.

***

### Технологии

- Python 3.10 + Flask + passlib + PyJWT в security  
- Node.js (Alpine) + Express + MinIO SDK + express-prometheus-middleware в uploader  
- MinIO для S3-совместимого хранилища  
- Nginx в качестве API Gateway для маршрутизации и авторизации запросов  
- Prometheus для мониторинга и сбора метрик обоих приложений

***

### Паттерны архитектуры

Использован классический паттерн **API Gateway** — единая точка входа и разграничение доступа, что упрощает взаимодействие с микросервисной системой, повышает безопасность и упрощает масштабирование. MinIO отвечает за надежное хранение данных, uploader — за прием и обработку файлов, security — за защиту приложений.

Промежуточные компоненты (gateway и security) помогают централизации логики безопасности и мониторинга, разгружая бизнес-логику uploader. Использование Docker Compose и volume позволяет легко разворачивать и поддерживать инфраструктуру.

***